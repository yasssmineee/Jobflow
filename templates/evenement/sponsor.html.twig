{% extends 'home/userlogin.html.twig' %}
    {% block header %}
        <!-- Include the header block from the base template -->
        {{ parent() }}
    {% endblock %}
{% block title %}Hello SponsorController!{% endblock %}

{% block body %}
<style>
    .container { margin-top: 20px; }
    .search-input { max-width: 300px; }
    .table-wrapper { margin-top: 20px; }
    .table-wrapper table { width: 100%; border-collapse: collapse; }
    .table-wrapper th, .table-wrapper td { padding: 8px 12px; border: 1px solid #ddd; }
    .table-wrapper th { background-color: #000; color: #fff; }
    .table-wrapper tr:nth-child(even) { background-color: #f2f2f2; }
    .table-wrapper tr:hover { background-color: #ddd; }
    .btn-group { display: flex; justify-content: space-between; }
    .btn-group a { flex: 1; text-align: center; }
</style>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<div class="container">
    <h1>RÃ©sultats de la recherche</h1>
    <div class="search-form">
        <input type="text" class="form-control search-input" id="search" placeholder="Rechercher par Nom ou Type">
    </div>
    <div class="d-flex justify-content-center mb-4"> 
    <form action="{{ path('app_sponsor') }}" method="get">
        <select class="form-select" name="sort">
            <option value="nom">Trier par nom</option>
            <option value="type">Trier par type</option>
        </select>
        <button type="submit" class="btn btn-secondary">Trier</button>
        <input type="hidden" name="q" value="{{ searchTerm is defined ? searchTerm : '' }}">
    </form>
</div>
    <div class="table-wrapper">
        <table id="searchResultsTable">
            <thead>
                <tr>
                    <th>Nom</th>
                    <th>Type</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for sponsorItem in sponsor %}
                    <tr>
                        <td>{{ sponsorItem.nom }}</td>
                        <td>{{ sponsorItem.type }}</td>
                        <td class="btn-group">
                            <a href="{{ path('app_supp_sponsor', {'id': sponsorItem.id}) }}" class="btn btn-danger">Supprimer</a>
                            <a href="{{ path('app_modifier_sponsor', {'id': sponsorItem.id}) }}" class="btn btn-primary">Modifier</a>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
    document.getElementById('search').addEventListener('keyup', function() {
        var searchTerm = this.value.toLowerCase();
        var rows = document.querySelectorAll('#searchResultsTable tbody tr');
        rows.forEach(function(row) {
            var name = row.querySelector('td:nth-child(1)').textContent.toLowerCase();
            var type = row.querySelector('td:nth-child(2)').textContent.toLowerCase();
            if (name.includes(searchTerm) || type.includes(searchTerm) || searchTerm === '') {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    });
</script>

<div class="container">
    <h1>Statistiques par Nom et Type :</h1>
    <div style="width: 500px; height: 500px; margin: auto;">
        <canvas id="pieChart"></canvas>
    </div>
</div>

<script>
    var ctx = document.getElementById('pieChart').getContext('2d');
    var data = {
        labels: [
            {% for stat in stats %}
                "{{ stat.nom }} - {{ stat.type }}",
            {% endfor %}
        ],
        datasets: [{
            data: [
                {% for stat in stats %}
                    {{ stat.count }},
                {% endfor %}
            ],
            backgroundColor: [
                'rgba(255, 99, 132, 0.7)', // rouge
                'rgba(54, 162, 235, 0.7)',  // bleu
                'rgba(255, 206, 86, 0.7)',  // jaune
                'rgba(75, 192, 192, 0.7)',  // turquoise
                'rgba(153, 102, 255, 0.7)', // violet
            ],
        }]
    };
    var options = {
        responsive: true,
        maintainAspectRatio: false,
    };
    var myPieChart = new Chart(ctx, {
        type: 'pie',
        data: data,
        options: options
    });
</script>

{% endblock %}
